@page "/beorg/dossier"

@using System.IO
@inject IDialogService DialogService

<MudPaper Class="d-flex flex-column" Style="height: calc(100vh - 80px);" Elevation="0">
    
    <!-- Barre d'outils en haut -->
    <MudToolBar Dense="true">
        <MudMenu Label="Récents" Variant="Variant.Text" EndIcon="@Icons.Material.Filled.ArrowDropDown">
            <!-- On simulera les récents ici -->
            <MudMenuItem>25.01.116 MG GR POLE SANTE</MudMenuItem>
            <MudMenuItem>24.10.170 YB PE MANITOU</MudMenuItem>
        </MudMenu>
        <MudButton Variant="Variant.Text" OnClick="@OpenSearchDialog">Rechercher</MudButton>
        <MudSpacer />
        <MudText Typo="Typo.body2" Class="mr-2">Dossier :</MudText>
        <MudText Typo="Typo.body1"><b>25.01.116 MG GR POLE SANTE FONTENAY LE COMTE</b></MudText>
    </MudToolBar>

    <!-- Zone principale -->
    <MudGrid Spacing="0" Class="flex-grow-1" Style="overflow-y: auto;">
        
        <!-- Colonne de gauche : Arborescence -->
        <MudItem xs="4" Class="pa-2" Style="border-right: 1px solid var(--mud-palette-lines-default);">
            <MudTreeView T="string" ExpandOnClick="true">
                <MudTreeViewItem Value="@("25.01.116...")" Icon="@Icons.Material.Filled.Folder">
                    <MudTreeViewItem Value="@("_CONTRAT")" Icon="@Icons.Material.Filled.Folder"/>
                    <MudTreeViewItem Value="@("BETON")" Icon="@Icons.Material.Filled.Folder">
                        <MudTreeViewItem Value="@("CALCULS&PLANS")" Icon="@Icons.Material.Filled.Folder">
                            <MudTreeViewItem Value="@("I-APS")" Icon="@Icons.Material.Filled.Folder"/>
                        </MudTreeViewItem>
                    </MudTreeViewItem>
                </MudTreeViewItem>
            </MudTreeView>
        </MudItem>

        <!-- Colonne de droite : Liste des fichiers -->
        <MudItem xs="8" Class="pa-2">
            <MudTable Items="@_files" Hover="true" Dense="true">
                <HeaderContent>
                    <MudTh>Nom</MudTh>
                    <MudTh>Taille</MudTh>
                    <MudTh>Type</MudTh>
                    <MudTh>Modifié le</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Nom">@context.Name</MudTd>
                    <MudTd DataLabel="Taille">@context.Size</MudTd>
                    <MudTd DataLabel="Type">@context.Type</MudTd>
                    <MudTd DataLabel="Modifié le">@context.Modified.ToString("g")</MudTd>
                </RowTemplate>
            </MudTable>
        </MudItem>
    </MudGrid>

    <!-- Barre d'état en bas -->
    <MudPaper Elevation="2" Class="pa-1" Square="true">
        <MudText Typo="Typo.caption">\\SRVIDES\dossiers\25.01.116...\BETON\CALCULS&PLANS\I-APS</MudText>
    </MudPaper>
</MudPaper>

@code {
    // Données de simulation pour la table
    private class FileData {
        public string Name { get; set; } = "";
        public string Size { get; set; } = "";
        public string Type { get; set; } = "";
        public DateTime Modified { get; set; }
    }

    private IEnumerable<FileData> _files = new List<FileData>
    {
        new FileData { Name = "REV2501_2501116.RVT", Size = "159 Mo", Type = "Fichier RVT", Modified = new DateTime(2025, 12, 18, 17, 56, 0) },
        new FileData { Name = "Plan_Coffrage.pdf", Size = "2 Mo", Type = "Fichier PDF", Modified = new DateTime(2025, 12, 17, 11, 2, 0) }
    };

    private async Task OpenSearchDialog()
    {
        var parameters = new DialogParameters();
        var options = new DialogOptions { CloseOnEscapeKey = true };
        
        var dialog = await DialogService.ShowAsync<SearchDialog>("Rechercher un dossier", parameters, options);
        var result = await dialog.Result;
        
        if (result != null && !result.Canceled)
        {
            // Traiter le résultat de la recherche si nécessaire
        }
    }
}
