@page "/quantitatif"
@using IDES.Application.Interfaces
@using IDES.Domain
@using IDES.Domain.Catalogue
@using IDES.Domain.Metre
@using MudBlazor
@inject IElementFactory ElementFactory
@inject ICatalogueService CatalogueService
@inject IMetreService MetreService

<MudText Typo="Typo.h3" GutterBottom="true">Test Quantitatif</MudText>

<MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="AjouterPoutre">Ajouter Poutre</MudButton>

<MudList T="string" Class="mt-4">
    @foreach (var item in MetreService.Metre)
    {
        <MudListItem>
            @if (item is ElementDynamique element)
            {
                <b>@element.NomElement</b> @element.Repere @element.Designation
            }
            else if (item is TitreElement titre)
            {
                <MudText Typo="Typo.h6">@titre.Numero @titre.Texte</MudText>
            }
        </MudListItem>
    }
</MudList>

@code {
    private async Task AjouterPoutre()
    {
        try
        {
            var catalogue = await CatalogueService.GetCatalogueAsync();
            
            // On récupère une définition pour le test
            var definition = catalogue.FirstOrDefault(e => e.Nom.Contains("Poutre")) 
                ?? catalogue.FirstOrDefault();

            if (definition != null)
            {
                var element = ElementFactory.CreerElementDynamique(definition);
                MetreService.AjouterElement(element);
            }
        }
        catch (Exception ex)
        {
            // En cas d'erreur (ex: base de données non initialisée)
            Console.WriteLine($"Erreur : {ex.Message}");
        }
    }
}
